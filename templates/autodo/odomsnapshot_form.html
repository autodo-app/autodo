{% extends "base_generic.html" %}

{% block title %}
Create Refueling - {{ block.super }}
{% endblock %}

{% block content %}
<div class="container p-8 mx-auto max-w-lg">
  {% if form.instance.id %}
  <div class="text-2xl">Edit Refueling</div>
  {% else %}
  <div class="text-2xl">Enter a Refueling</div>
  {% endif %}

  <form action="" method="post">
    {% csrf_token %}

    {% for field in form %}
    {{ field }}
    <label class="m-4 text-sm text-gray-700" for="{{ field.auto_id }}">
      {{ field.label }}{% if field.field.required %}*{% endif %}
    </label>
    <br>
    {% endfor %}

    {{ refueling.management_form }}
    {% for form in refueling.forms %}
    {% for field in form.visible_fields %}
    {{ field }}
    <label class="m-4 text-sm text-gray-700" for="{{ field.auto_id }}">
      {{ field.label }}{% if field.field.required %}*{% endif %}
    </label>
    <br>
    {% endfor %}
    {% endfor %}

    <button type="submit" class="bg-blue-500 hover:bg-blue-400 text-white font-bold py-2 px-4 my-2 rounded shadow-md">
      {% if form.instance.id %}Edit{% else %}Create{% endif %}
    </button>
  </form>
</div>
<script>
  var mileage = document.getElementById("id_mileage");
  var car = document.getElementById("id_car");
  console.log(car)
  car.addEventListener('change', function (event) {
    var carstr = '{{ cars }}'.replaceAll('&quot;', '\"');
    var cardata = JSON.parse(carstr);
    var snapstr = '{{ snaps }}'.replaceAll('&quot;', '\"');
    var snapdata = JSON.parse(snapstr);
    for (var c in cardata) {
      if (parseInt(cardata[c].pk) === parseInt(car.value)) {
        var m = 0;
        for (var s in snapdata) {
          if (parseInt(snapdata[s].fields.car) === parseInt(car.value) && snapdata[s].fields.mileage > m) {
            m = snapdata[s].fields.mileage;
          }
        }
        mileage.value = m;
      }
    }
  }, false);
</script>
{% endblock %}
